zabbix_export:
  version: '7.4'
  templates:
    - template: 'Windows by SNMP Compatible'
      name: 'Windows by SNMP Compatible'
      description: 'Compatible template for Categraf SNMP Zabbix plugin. Removes DEPENDENT items.'
      groups:
        - name: 'Templates/Operating systems'
      items:
        - name: 'System contact details'
          type: SNMP_AGENT
          snmp_oid: 1.3.6.1.2.1.1.4.0
          key: system.contact
          value_type: CHAR
        - name: 'CPU utilization'
          type: SNMP_AGENT
          snmp_oid: 'discovery[{#CPU.UTIL},1.3.6.1.2.1.25.3.3.1.2]'
          key: system.cpu.util
          value_type: FLOAT
          units: '%'
          preprocessing:
            - type: JSONPATH
              parameters:
                - '$..[''{#CPU.UTIL}''].avg()'
        - name: 'System description'
          type: SNMP_AGENT
          snmp_oid: 1.3.6.1.2.1.1.1.0
          key: system.descr
          value_type: CHAR
        - name: 'Uptime (hardware)'
          type: SNMP_AGENT
          snmp_oid: 1.3.6.1.2.1.25.1.1.0
          key: system.hw.uptime
          units: uptime
          preprocessing:
            - type: MULTIPLIER
              parameters: ['0.01']
        - name: 'System location'
          type: SNMP_AGENT
          snmp_oid: 1.3.6.1.2.1.1.6.0
          key: system.location
          value_type: CHAR
        - name: 'System name'
          type: SNMP_AGENT
          snmp_oid: 1.3.6.1.2.1.1.5.0
          key: system.name
          value_type: CHAR
        - name: 'Uptime (network)'
          type: SNMP_AGENT
          snmp_oid: 1.3.6.1.2.1.1.3.0
          key: system.net.uptime
          units: uptime
          preprocessing:
            - type: MULTIPLIER
              parameters: ['0.01']
        - name: 'System object ID'
          type: SNMP_AGENT
          snmp_oid: 1.3.6.1.2.1.1.2.0
          key: system.objectid
          value_type: CHAR
      discovery_rules:
        - name: 'Network interfaces discovery'
          type: SNMP_AGENT
          key: net.if.discovery
          delay: 1h
          snmp_oid: 'walk[1.3.6.1.2.1.2.2.1.8,1.3.6.1.2.1.2.2.1.7,1.3.6.1.2.1.31.1.1.1.18,1.3.6.1.2.1.31.1.1.1.1,1.3.6.1.2.1.2.2.1.2,1.3.6.1.2.1.2.2.1.3]'
          preprocessing:
            - type: SNMP_WALK_TO_JSON
              parameters:
                - '{#IFOPERSTATUS}'
                - 1.3.6.1.2.1.2.2.1.8
                - '0'
                - '{#IFADMINSTATUS}'
                - 1.3.6.1.2.1.2.2.1.7
                - '0'
                - '{#IFALIAS}'
                - 1.3.6.1.2.1.31.1.1.1.18
                - '0'
                - '{#IFNAME}'
                - 1.3.6.1.2.1.31.1.1.1.1
                - '0'
                - '{#IFDESCR}'
                - 1.3.6.1.2.1.2.2.1.2
                - '0'
                - '{#IFTYPE}'
                - 1.3.6.1.2.1.2.2.1.3
                - '0'
          item_prototypes:
            - name: 'Interface {#IFNAME}({#IFALIAS}): Bits received'
              type: SNMP_AGENT
              snmp_oid: '1.3.6.1.2.1.2.2.1.10.{#SNMPINDEX}'
              key: 'net.if.in[{#IFNAME}]'
              units: bps
              preprocessing:
                - type: CHANGE_PER_SECOND
                - type: MULTIPLIER
                  parameters: ['8']
            - name: 'Interface {#IFNAME}({#IFALIAS}): Bits sent'
              type: SNMP_AGENT
              snmp_oid: '1.3.6.1.2.1.2.2.1.16.{#SNMPINDEX}'
              key: 'net.if.out[{#IFNAME}]'
              units: bps
              preprocessing:
                - type: CHANGE_PER_SECOND
                - type: MULTIPLIER
                  parameters: ['8']
            - name: 'Interface {#IFNAME}({#IFALIAS}): Speed'
              type: SNMP_AGENT
              snmp_oid: '1.3.6.1.2.1.31.1.1.1.15.{#SNMPINDEX}'
              key: 'net.if.speed[{#IFNAME}]'
              units: bps
              preprocessing:
                - type: MULTIPLIER
                  parameters: ['1000000']
            - name: 'Interface {#IFNAME}({#IFALIAS}): Operational status'
              type: SNMP_AGENT
              snmp_oid: '1.3.6.1.2.1.2.2.1.8.{#SNMPINDEX}'
              key: 'net.if.status[{#IFNAME}]'

        - name: 'Mounted filesystem discovery'
          type: SNMP_AGENT
          key: vfs.fs.discovery
          delay: 1h
          snmp_oid: 'walk[1.3.6.1.2.1.25.2.3.1.3,1.3.6.1.2.1.25.2.3.1.2,1.3.6.1.2.1.25.2.3.1.4,1.3.6.1.2.1.25.2.3.1.5,1.3.6.1.2.1.25.2.3.1.6]'
          preprocessing:
            - type: SNMP_WALK_TO_JSON
              parameters:
                - '{#FSNAME}'
                - 1.3.6.1.2.1.25.2.3.1.3
                - '0'
                - '{#FSTYPE}'
                - 1.3.6.1.2.1.25.2.3.1.2
                - '0'
                - '{#ALLOC_UNITS}'
                - 1.3.6.1.2.1.25.2.3.1.4
                - '0'
                - '{#FSSIZE}'
                - 1.3.6.1.2.1.25.2.3.1.5
                - '0'
                - '{#FSUSED}'
                - 1.3.6.1.2.1.25.2.3.1.6
                - '0'
          item_prototypes:
            - name: 'FS [{#FSNAME}]: Space: Used, in %'
              type: CALCULATED
              key: 'vfs.fs.pused[{#FSNAME}]'
              value_type: FLOAT
              units: '%'
              params: 'last(//vfs.fs.used[{#FSNAME}])/last(//vfs.fs.total[{#FSNAME}])*100'
            - name: 'FS [{#FSNAME}]: Space: Total'
              type: SNMP_AGENT
              snmp_oid: '1.3.6.1.2.1.25.2.3.1.5.{#SNMPINDEX}'
              key: 'vfs.fs.total[{#FSNAME}]'
              units: B
              preprocessing:
                - type: MULTIPLIER
                  parameters: ['{#ALLOC_UNITS}']
            - name: 'FS [{#FSNAME}]: Space: Used'
              type: SNMP_AGENT
              snmp_oid: '1.3.6.1.2.1.25.2.3.1.6.{#SNMPINDEX}'
              key: 'vfs.fs.used[{#FSNAME}]'
              units: B
              preprocessing:
                - type: MULTIPLIER
                  parameters: ['{#ALLOC_UNITS}']

        - name: 'Memory discovery'
          type: SNMP_AGENT
          key: vm.memory.discovery
          delay: 1h
          snmp_oid: 'walk[1.3.6.1.2.1.25.2.3.1.3,1.3.6.1.2.1.25.2.3.1.2,1.3.6.1.2.1.25.2.3.1.4,1.3.6.1.2.1.25.2.3.1.6,1.3.6.1.2.1.25.2.3.1.5]'
          preprocessing:
             - type: SNMP_WALK_TO_JSON
               parameters:
                 - '{#MEMNAME}'
                 - 1.3.6.1.2.1.25.2.3.1.3
                 - '0'
                 - '{#MEMTYPE}'
                 - 1.3.6.1.2.1.25.2.3.1.2
                 - '0'
                 - '{#ALLOC_UNITS}'
                 - 1.3.6.1.2.1.25.2.3.1.4
                 - '0'
                 - '{#MEMUSED}'
                 - 1.3.6.1.2.1.25.2.3.1.6
                 - '0'
                 - '{#MEMSIZE}'
                 - 1.3.6.1.2.1.25.2.3.1.5
                 - '0'
          filter:
             evaltype: AND
             conditions:
               - macro: '{#MEMNAME}'
                 value: 'Physical Memory'
          item_prototypes:
            - name: '{#MEMNAME}: Used'
              type: SNMP_AGENT
              snmp_oid: '1.3.6.1.2.1.25.2.3.1.6.{#SNMPINDEX}'
              key: 'vm.memory.used[{#MEMNAME}]'
              units: B
              preprocessing:
                - type: MULTIPLIER
                  parameters: ['{#ALLOC_UNITS}']
            - name: '{#MEMNAME}: Total'
              type: SNMP_AGENT
              snmp_oid: '1.3.6.1.2.1.25.2.3.1.5.{#SNMPINDEX}'
              key: 'vm.memory.total[{#MEMNAME}]'
              units: B
              preprocessing:
                - type: MULTIPLIER
                  parameters: ['{#ALLOC_UNITS}']
            - name: '{#MEMNAME}: Utilization'
              type: CALCULATED
              key: 'vm.memory.util[{#MEMNAME}]'
              value_type: FLOAT
              units: '%'
              params: 'last(//vm.memory.used[{#MEMNAME}])/last(//vm.memory.total[{#MEMNAME}])*100'
