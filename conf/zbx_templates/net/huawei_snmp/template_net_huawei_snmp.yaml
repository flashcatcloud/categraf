zabbix_export:
  version: '7.4'
  templates:
    - template: 'Huawei VRP by SNMP Compatible'
      name: 'Huawei VRP by SNMP Compatible'
      description: 'Compatible template for Categraf SNMP Zabbix plugin. Removes DEPENDENT items.'
      groups:
        - name: 'Templates/Network devices'
      items:
        - name: 'System contact details'
          type: SNMP_AGENT
          snmp_oid: 1.3.6.1.2.1.1.4.0
          key: system.contact
          value_type: CHAR
        - name: 'System description'
          type: SNMP_AGENT
          snmp_oid: 1.3.6.1.2.1.1.1.0
          key: system.descr
          value_type: CHAR
        - name: 'Uptime (hardware)'
          type: SNMP_AGENT
          snmp_oid: 1.3.6.1.2.1.25.1.1.0
          key: system.hw.uptime
          units: uptime
          preprocessing:
            - type: MULTIPLIER
              parameters: ['0.01']
        - name: 'System location'
          type: SNMP_AGENT
          snmp_oid: 1.3.6.1.2.1.1.6.0
          key: system.location
          value_type: CHAR
        - name: 'System name'
          type: SNMP_AGENT
          snmp_oid: 1.3.6.1.2.1.1.5.0
          key: system.name
          value_type: CHAR
        - name: 'Uptime (network)'
          type: SNMP_AGENT
          snmp_oid: 1.3.6.1.2.1.1.3.0
          key: system.net.uptime
          units: uptime
          preprocessing:
            - type: MULTIPLIER
              parameters: ['0.01']
        - name: 'System object ID'
          type: SNMP_AGENT
          snmp_oid: 1.3.6.1.2.1.1.2.0
          key: system.objectid
          value_type: CHAR
      discovery_rules:
        - name: 'FAN Discovery'
          type: SNMP_AGENT
          key: discovery.fans
          delay: 1h
          snmp_oid: 'walk[1.3.6.1.4.1.2011.5.25.31.1.1.10.1.1,1.3.6.1.4.1.2011.5.25.31.1.1.10.1.7]'
          preprocessing:
            - type: SNMP_WALK_TO_JSON
              parameters:
                - '{#SNMPVALUE}'
                - 1.3.6.1.4.1.2011.5.25.31.1.1.10.1.1
                - '0'
                - '{#FAN_STATUS}'
                - 1.3.6.1.4.1.2011.5.25.31.1.1.10.1.7
                - '0'
          item_prototypes:
            - name: '#{#SNMPVALUE}: Fan status'
              type: SNMP_AGENT
              snmp_oid: '1.3.6.1.4.1.2011.5.25.31.1.1.10.1.7.{#SNMPINDEX}'
              key: 'sensor.fan.status[{#SNMPVALUE}]'

        - name: 'Entity Discovery'
          type: SNMP_AGENT
          key: entity.discovery
          delay: 1h
          snmp_oid: 'walk[1.3.6.1.2.1.47.1.1.1.1.5,1.3.6.1.2.1.47.1.1.1.1.7,1.3.6.1.2.1.47.1.1.1.1.2,1.3.6.1.2.1.47.1.1.1.1.8,1.3.6.1.2.1.47.1.1.1.1.10]'
          preprocessing:
            - type: SNMP_WALK_TO_JSON
              parameters:
                - '{#ENT_CLASS}'
                - 1.3.6.1.2.1.47.1.1.1.1.5
                - '0'
                - '{#ENT_NAME}'
                - 1.3.6.1.2.1.47.1.1.1.1.7
                - '0'
          filter:
            conditions:
              - macro: '{#ENT_CLASS}'
                value: '3'
          item_prototypes:
            - name: '{#ENT_NAME}: Hardware model name'
              type: SNMP_AGENT
              snmp_oid: '1.3.6.1.2.1.47.1.1.1.1.2.{#SNMPINDEX}'
              key: 'system.hw.model[{#ENT_NAME}]'
              value_type: CHAR

        - name: 'MPU Discovery'
          type: SNMP_AGENT
          key: mpu.discovery
          delay: 1h
          snmp_oid: 'walk[1.3.6.1.2.1.47.1.1.1.1.7,1.3.6.1.4.1.2011.5.25.31.1.1.1.1.11,1.3.6.1.4.1.2011.5.25.31.1.1.1.1.5,1.3.6.1.2.1.47.1.1.1.1.11,1.3.6.1.2.1.47.1.1.1.1.8,1.3.6.1.2.1.47.1.1.1.1.10,1.3.6.1.4.1.2011.5.25.31.1.1.1.1.7]'
          preprocessing:
            - type: SNMP_WALK_TO_JSON
              parameters:
                - '{#ENT_NAME}'
                - 1.3.6.1.2.1.47.1.1.1.1.7
                - '0'
          filter:
            conditions:
              - macro: '{#ENT_NAME}'
                value: 'MPU.*'
          item_prototypes:
            - name: '{#ENT_NAME}: Temperature'
              type: SNMP_AGENT
              snmp_oid: '1.3.6.1.4.1.2011.5.25.31.1.1.1.1.11.{#SNMPINDEX}'
              key: 'sensor.temp.value[{#ENT_NAME}]'
              value_type: FLOAT
              units: Â°C
            - name: '{#ENT_NAME}: CPU utilization'
              type: SNMP_AGENT
              snmp_oid: '1.3.6.1.4.1.2011.5.25.31.1.1.1.1.5.{#SNMPINDEX}'
              key: 'system.cpu.util[{#ENT_NAME}]'
              value_type: FLOAT
              units: '%'
            - name: '{#ENT_NAME}: Hardware serial number'
              type: SNMP_AGENT
              snmp_oid: '1.3.6.1.2.1.47.1.1.1.1.11.{#SNMPINDEX}'
              key: 'system.hw.serialnumber[{#ENT_NAME}]'
              value_type: CHAR
            - name: '{#ENT_NAME}: Hardware version(revision)'
              type: SNMP_AGENT
              snmp_oid: '1.3.6.1.2.1.47.1.1.1.1.8.{#SNMPINDEX}'
              key: 'system.hw.version[{#ENT_NAME}]'
              value_type: CHAR
            - name: '{#ENT_NAME}: Operating system'
              type: SNMP_AGENT
              snmp_oid: '1.3.6.1.2.1.47.1.1.1.1.10.{#SNMPINDEX}'
              key: 'system.sw.os[{#ENT_NAME}]'
              value_type: CHAR
            - name: '{#ENT_NAME}: Memory utilization'
              type: SNMP_AGENT
              snmp_oid: '1.3.6.1.4.1.2011.5.25.31.1.1.1.1.7.{#SNMPINDEX}'
              key: 'vm.memory.util[{#ENT_NAME}]'
              value_type: FLOAT
              units: '%'

        - name: 'Network interfaces discovery'
          type: SNMP_AGENT
          key: net.if.discovery
          delay: 1h
          snmp_oid: 'walk[1.3.6.1.2.1.2.2.1.8,1.3.6.1.2.1.2.2.1.7,1.3.6.1.2.1.31.1.1.1.18,1.3.6.1.2.1.31.1.1.1.1,1.3.6.1.2.1.2.2.1.2,1.3.6.1.2.1.2.2.1.3]'
          preprocessing:
            - type: SNMP_WALK_TO_JSON
              parameters:
                - '{#IFOPERSTATUS}'
                - 1.3.6.1.2.1.2.2.1.8
                - '0'
                - '{#IFADMINSTATUS}'
                - 1.3.6.1.2.1.2.2.1.7
                - '0'
                - '{#IFALIAS}'
                - 1.3.6.1.2.1.31.1.1.1.18
                - '0'
                - '{#IFNAME}'
                - 1.3.6.1.2.1.31.1.1.1.1
                - '0'
                - '{#IFDESCR}'
                - 1.3.6.1.2.1.2.2.1.2
                - '0'
                - '{#IFTYPE}'
                - 1.3.6.1.2.1.2.2.1.3
                - '0'
          item_prototypes:
            - name: 'Interface {#IFNAME}({#IFALIAS}): Bits received'
              type: SNMP_AGENT
              snmp_oid: '1.3.6.1.2.1.31.1.1.1.6.{#SNMPINDEX}'
              key: 'net.if.in[{#IFNAME}]'
              units: bps
              preprocessing:
                - type: CHANGE_PER_SECOND
                - type: MULTIPLIER
                  parameters: ['8']
            - name: 'Interface {#IFNAME}({#IFALIAS}): Bits sent'
              type: SNMP_AGENT
              snmp_oid: '1.3.6.1.2.1.31.1.1.1.10.{#SNMPINDEX}'
              key: 'net.if.out[{#IFNAME}]'
              units: bps
              preprocessing:
                - type: CHANGE_PER_SECOND
                - type: MULTIPLIER
                  parameters: ['8']
            - name: 'Interface {#IFNAME}({#IFALIAS}): Speed'
              type: SNMP_AGENT
              snmp_oid: '1.3.6.1.2.1.31.1.1.1.15.{#SNMPINDEX}'
              key: 'net.if.speed[{#IFNAME}]'
              units: bps
              preprocessing:
                - type: MULTIPLIER
                  parameters: ['1000000']
            - name: 'Interface {#IFNAME}({#IFALIAS}): Operational status'
              type: SNMP_AGENT
              snmp_oid: '1.3.6.1.2.1.2.2.1.8.{#SNMPINDEX}'
              key: 'net.if.status[{#IFNAME}]'
            - name: 'Interface {#IFNAME}({#IFALIAS}): Interface type'
              type: SNMP_AGENT
              snmp_oid: '1.3.6.1.2.1.2.2.1.3.{#SNMPINDEX}'
              key: 'net.if.type[{#IFNAME}]'
