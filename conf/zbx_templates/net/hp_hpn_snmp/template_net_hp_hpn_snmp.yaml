zabbix_export:
  version: '6.0'
  templates:
    - template: 'HP Enterprise Switch by SNMP Compatible'
      name: 'HP Enterprise Switch by SNMP Compatible'
      description: 'Compatible template for Categraf SNMP Zabbix plugin. Removes DEPENDENT items.'
      groups:
        - name: 'Templates/Network devices'
      items:
        - name: 'System contact details'
          type: SNMP_AGENT
          snmp_oid: 1.3.6.1.2.1.1.4.0
          key: system.contact
          value_type: CHAR
        - name: 'CPU utilization'
          type: SNMP_AGENT
          snmp_oid: 1.3.6.1.4.1.11.2.14.11.5.1.9.6.1.0
          key: system.cpu.util
          value_type: FLOAT
          units: '%'
        - name: 'System description'
          type: SNMP_AGENT
          snmp_oid: 1.3.6.1.2.1.1.1.0
          key: system.descr
          value_type: CHAR
        - name: 'Firmware version'
          type: SNMP_AGENT
          snmp_oid: 1.3.6.1.4.1.11.2.14.11.5.1.1.3.0
          key: system.hw.firmware
          value_type: CHAR
        - name: 'Hardware serial number'
          type: SNMP_AGENT
          snmp_oid: 1.3.6.1.4.1.11.2.36.1.1.2.9.0
          key: system.hw.serialnumber
          value_type: CHAR
        - name: 'Uptime (hardware)'
          type: SNMP_AGENT
          snmp_oid: 1.3.6.1.2.1.25.1.1.0
          key: system.hw.uptime
          units: uptime
          preprocessing:
            - type: MULTIPLIER
              parameters: ['0.01']
        - name: 'System location'
          type: SNMP_AGENT
          snmp_oid: 1.3.6.1.2.1.1.6.0
          key: system.location
          value_type: CHAR
        - name: 'System name'
          type: SNMP_AGENT
          snmp_oid: 1.3.6.1.2.1.1.5.0
          key: system.name
          value_type: CHAR
        - name: 'Uptime (network)'
          type: SNMP_AGENT
          snmp_oid: 1.3.6.1.2.1.1.3.0
          key: system.net.uptime
          units: uptime
          preprocessing:
            - type: MULTIPLIER
              parameters: ['0.01']
        - name: 'System object ID'
          type: SNMP_AGENT
          snmp_oid: 1.3.6.1.2.1.1.2.0
          key: system.objectid
          value_type: CHAR
      discovery_rules:
        - name: 'Entity Discovery'
          type: SNMP_AGENT
          key: entity.discovery
          delay: 1h
          snmp_oid: 'walk[1.3.6.1.2.1.47.1.1.1.1.5,1.3.6.1.2.1.47.1.1.1.1.7,1.3.6.1.2.1.47.1.1.1.1.2,1.3.6.1.2.1.47.1.1.1.1.8]'
          preprocessing:
            - type: SNMP_WALK_TO_JSON
              parameters:
                - '{#ENT_CLASS}'
                - 1.3.6.1.2.1.47.1.1.1.1.5
                - '0'
                - '{#ENT_NAME}'
                - 1.3.6.1.2.1.47.1.1.1.1.7
                - '0'
          filter:
            conditions:
              - macro: '{#ENT_CLASS}'
                value: '3'
          item_prototypes:
            - name: '{#ENT_NAME}: Hardware model name'
              type: SNMP_AGENT
              snmp_oid: '1.3.6.1.2.1.47.1.1.1.1.2.{#SNMPINDEX}'
              key: 'system.hw.model[{#ENT_NAME}]'
              value_type: CHAR
            - name: '{#ENT_NAME}: Hardware version(revision)'
              type: SNMP_AGENT
              snmp_oid: '1.3.6.1.2.1.47.1.1.1.1.8.{#SNMPINDEX}'
              key: 'system.hw.version[{#ENT_NAME}]'
              value_type: CHAR

        - name: 'FAN Discovery'
          type: SNMP_AGENT
          key: fan.discovery
          delay: 1h
          snmp_oid: 'walk[1.3.6.1.4.1.11.2.14.11.1.2.6.1.2,1.3.6.1.4.1.11.2.14.11.1.2.6.1.7,1.3.6.1.4.1.11.2.14.11.1.2.6.1.4]'
          preprocessing:
            - type: SNMP_WALK_TO_JSON
              parameters:
                - '{#ENT_CLASS}'
                - 1.3.6.1.4.1.11.2.14.11.1.2.6.1.2
                - '0'
                - '{#ENT_DESCR}'
                - 1.3.6.1.4.1.11.2.14.11.1.2.6.1.7
                - '0'
                - '{#ENT_STATUS}'
                - 1.3.6.1.4.1.11.2.14.11.1.2.6.1.4
                - '0'
          filter:
            evaltype: AND
            conditions:
              - macro: '{#ENT_CLASS}'
                value: .+8.3.2$
              - macro: '{#ENT_STATUS}'
                value: (1|2|3|4)
          item_prototypes:
            - name: '{#ENT_DESCR}: Fan status'
              type: SNMP_AGENT
              snmp_oid: '1.3.6.1.4.1.11.2.14.11.1.2.6.1.4.{#SNMPINDEX}'
              key: 'sensor.fan.status[{#ENT_DESCR}]'

        - name: 'Memory Discovery'
          type: SNMP_AGENT
          key: memory.discovery
          delay: 1h
          snmp_oid: 'walk[1.3.6.1.4.1.11.2.14.11.5.1.1.2.1.1.1.1]'
          preprocessing:
            - type: SNMP_WALK_TO_JSON
              parameters:
                - '{#SNMPVALUE}'
                - 1.3.6.1.4.1.11.2.14.11.5.1.1.2.1.1.1.1
                - '0'
          item_prototypes:
            - name: '#{#SNMPVALUE}: Available memory'
              type: SNMP_AGENT
              snmp_oid: '1.3.6.1.4.1.11.2.14.11.5.1.1.2.1.1.1.6.{#SNMPINDEX}'
              key: 'vm.memory.available[{#SNMPVALUE}]'
              units: B
            - name: '#{#SNMPVALUE}: Total memory'
              type: SNMP_AGENT
              snmp_oid: '1.3.6.1.4.1.11.2.14.11.5.1.1.2.1.1.1.5.{#SNMPINDEX}'
              key: 'vm.memory.total[{#SNMPVALUE}]'
              units: B
            - name: '#{#SNMPVALUE}: Used memory'
              type: SNMP_AGENT
              snmp_oid: '1.3.6.1.4.1.11.2.14.11.5.1.1.2.1.1.1.7.{#SNMPINDEX}'
              key: 'vm.memory.used[{#SNMPVALUE}]'
              units: B
            - name: '#{#SNMPVALUE}: Memory utilization'
              type: CALCULATED
              key: 'vm.memory.util[{#SNMPVALUE}]'
              value_type: FLOAT
              units: '%'
              params: 'last(//vm.memory.used[{#SNMPVALUE}])/last(//vm.memory.total[{#SNMPVALUE}])*100'

        - name: 'Network interfaces discovery'
          type: SNMP_AGENT
          key: net.if.discovery
          delay: 1h
          snmp_oid: 'walk[1.3.6.1.2.1.2.2.1.8,1.3.6.1.2.1.2.2.1.7,1.3.6.1.2.1.31.1.1.1.18,1.3.6.1.2.1.31.1.1.1.1,1.3.6.1.2.1.2.2.1.2,1.3.6.1.2.1.2.2.1.3]'
          preprocessing:
            - type: SNMP_WALK_TO_JSON
              parameters:
                - '{#IFOPERSTATUS}'
                - 1.3.6.1.2.1.2.2.1.8
                - '0'
                - '{#IFADMINSTATUS}'
                - 1.3.6.1.2.1.2.2.1.7
                - '0'
                - '{#IFALIAS}'
                - 1.3.6.1.2.1.31.1.1.1.18
                - '0'
                - '{#IFNAME}'
                - 1.3.6.1.2.1.31.1.1.1.1
                - '0'
                - '{#IFDESCR}'
                - 1.3.6.1.2.1.2.2.1.2
                - '0'
                - '{#IFTYPE}'
                - 1.3.6.1.2.1.2.2.1.3
                - '0'
          item_prototypes:
            - name: 'Interface {#IFNAME}({#IFALIAS}): Bits received'
              type: SNMP_AGENT
              snmp_oid: '1.3.6.1.2.1.31.1.1.1.6.{#SNMPINDEX}'
              key: 'net.if.in[{#IFNAME}]'
              units: bps
              preprocessing:
                - type: CHANGE_PER_SECOND
                - type: MULTIPLIER
                  parameters: ['8']
            - name: 'Interface {#IFNAME}({#IFALIAS}): Bits sent'
              type: SNMP_AGENT
              snmp_oid: '1.3.6.1.2.1.31.1.1.1.10.{#SNMPINDEX}'
              key: 'net.if.out[{#IFNAME}]'
              units: bps
              preprocessing:
                - type: CHANGE_PER_SECOND
                - type: MULTIPLIER
                  parameters: ['8']
            - name: 'Interface {#IFNAME}({#IFALIAS}): Speed'
              type: SNMP_AGENT
              snmp_oid: '1.3.6.1.2.1.31.1.1.1.15.{#SNMPINDEX}'
              key: 'net.if.speed[{#IFNAME}]'
              units: bps
              preprocessing:
                - type: MULTIPLIER
                  parameters: ['1000000']
            - name: 'Interface {#IFNAME}({#IFALIAS}): Operational status'
              type: SNMP_AGENT
              snmp_oid: '1.3.6.1.2.1.2.2.1.8.{#SNMPINDEX}'
              key: 'net.if.status[{#IFNAME}]'
            - name: 'Interface {#IFNAME}({#IFALIAS}): Interface type'
              type: SNMP_AGENT
              snmp_oid: '1.3.6.1.2.1.2.2.1.3.{#SNMPINDEX}'
              key: 'net.if.type[{#IFNAME}]'

        - name: 'PSU Discovery'
          type: SNMP_AGENT
          key: psu.discovery
          delay: 1h
          snmp_oid: 'walk[1.3.6.1.4.1.11.2.14.11.1.2.6.1.2,1.3.6.1.4.1.11.2.14.11.1.2.6.1.7,1.3.6.1.4.1.11.2.14.11.1.2.6.1.4]'
          preprocessing:
            - type: SNMP_WALK_TO_JSON
              parameters:
                - '{#ENT_CLASS}'
                - 1.3.6.1.4.1.11.2.14.11.1.2.6.1.2
                - '0'
                - '{#ENT_DESCR}'
                - 1.3.6.1.4.1.11.2.14.11.1.2.6.1.7
                - '0'
                - '{#ENT_STATUS}'
                - 1.3.6.1.4.1.11.2.14.11.1.2.6.1.4
                - '0'
          filter:
            evaltype: AND
            conditions:
              - macro: '{#ENT_CLASS}'
                value: .+8.3.1$
              - macro: '{#ENT_STATUS}'
                value: (1|2|3|4)
          item_prototypes:
            - name: '{#ENT_DESCR}: Power supply status'
              type: SNMP_AGENT
              snmp_oid: '1.3.6.1.4.1.11.2.14.11.1.2.6.1.4.{#SNMPINDEX}'
              key: 'sensor.psu.status[{#ENT_DESCR}]'

        - name: 'Temperature Discovery'
          type: SNMP_AGENT
          key: temp.precision0.discovery
          delay: 1h
          snmp_oid: 'walk[1.3.6.1.2.1.99.1.1.1.1,1.3.6.1.2.1.47.1.1.1.1.2,1.3.6.1.2.1.99.1.1.1.3]'
          preprocessing:
            - type: SNMP_WALK_TO_JSON
              parameters:
                - '{#SENSOR_TYPE}'
                - 1.3.6.1.2.1.99.1.1.1.1
                - '0'
                - '{#SENSOR_INFO}'
                - 1.3.6.1.2.1.47.1.1.1.1.2
                - '0'
                - '{#SENSOR_PRECISION}'
                - 1.3.6.1.2.1.99.1.1.1.3
                - '0'
          filter:
            evaltype: AND
            conditions:
              - macro: '{#SENSOR_PRECISION}'
                value: '0'
              - macro: '{#SENSOR_TYPE}'
                value: '8'
          item_prototypes:
            - name: '{#SENSOR_INFO}: Temperature'
              type: SNMP_AGENT
              snmp_oid: '1.3.6.1.2.1.99.1.1.1.4.{#SNMPINDEX}'
              key: 'sensor.temp.value[{#SENSOR_INFO}]'
              value_type: FLOAT
              units: Â°C
